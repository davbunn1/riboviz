# Test data for transcript annotation generation script

We want in riboviz a script `make_transcript_fasta_gff` or `make_transcript_annotation` that takes genome sequence fasta and genome-centric gff and uses that to make a compatible transcript sequence fasta and transcript-centric gff.

This annotationexamples directory contains small test data to use to make transcriptome gff and fasta files.

# Some yeast examples

These files are generated by Edward Wallace, April 2020, subsetting data from the [R64-2-1 genome release by SGD](http://sgd-archive.yeastgenome.org/sequence/S288C_reference/genome_releases/).
Some were generated automatically in [yeastutrgff/src/annotateUTRs.Rmd](https://github.com/ewallace/yeastutrgff/).

*WARNING* They have been spot-checked by eye but errors in some extensions might still remain. We need to run `check_fasta_gff` on the transcriptome fasta files before doing anything else.

## YAL10 example to test fixed-length extensions with CDS introns

10 genes from S. cerevisiae chromosome 1 from a real wild gff file supplied by a model organism database. There is one example of a transcript with CDS intron on both strands, but no UTR introns.

* `S288C_reference_sequence_R64-2-1_20150113_chrIchrII.fsa` - fasta format full sequences of chromosomes I & II, named chrI, chrII
* `saccharomyces_cerevisiae_R64-2-1_20150113_YAL10all.gff` - gff format annotation of most features on chrI:130000-152000, excluding dubious ORF YAL004W
* `YAL10_transcriptsfixed_R64-2-1_left18_right15.fasta` - fasta format of pseudo-transcripts with fixed-length extensions 18nt on left/5' and 15nt on right/3'
* `YAL10_transcriptsfixed_R64-2-1_left18_right15.gff` - gff format describing positions of CDSs within fasta

Suggested function call to make the `YAL10_*` files from the first two:

```
make_transcript_fasta_gff \
  --genome S288C_reference_sequence_R64-2-1_20150113_chrIchrII.fsa  \
  --features saccharomyces_cerevisiae_R64-2-1_20150113_YAL10all.gff \
  --featureType CDS --seqName CDS --attrName ID \
  --left5 18 --right3 15 \
  --outfilestem YAL10_transcriptsfixed_R64-2-1_left18_right15
```

This fixed-length YAL10 example is the easy version, implement this first.


## YBL72ish example to test variable-length UTRs including 5'UTR introns

Some genes from S. cerevisiae chromosome 2, including two with 5'UTR introns, although (accidentally) none with CDS introns. YBL092W in fact has a 5'UTR intron directly adjacent to the CDS.

Explicit UTR specification in gff file, made by EW from combining information from multiple SGD files. Relies on same genome fasta file as YAL10 example. 

* `saccharomyces_cerevisiae_R64-2-1_withUTRs_YBL72ish.gff` - gff format annotation of CDS, UTR, and intron features on chrII:45000-89500, made by subsetting `abundant_full-ORF_ypd_plus_other_fixed_UTR_length_transcripts_nointrons.gff` in `yeastutrgff`
* `YBL72ish_transcripts_withUTRs.fasta` - fasta format of transcripts with UTRs specified in above gff, made by subsetting `abundant_full-ORF_ypd_plus_other_fixed_UTR_length_transcripts_nointrons.fasta` from `yeastutrgff`
* `YBL72ish_transcripts_withUTRs.gff` - gff format describing positions of CDSs within fasta

Suggested function call to make the `YBL72ish_*` files from the first two:

```
make_transcript_fasta_gff \
  --genome S288C_reference_sequence_R64-2-1_20150113_chrIchrII.fsa  \
  --features saccharomyces_cerevisiae_R64-2-1_addUTRs_YBL72ish.gff \
  --featureType CDS --seqName Parent --attrName ID \
  --useUTRs TRUE --removeUTRintrons TRUE \
  --outfilestem YBL72ish_transcripts_withUTRs
```

# Suggested behaviour of flags

### feature names etc

* ``--featureType CDS` describes which feature Types (CDS, uORF, etc) in the gff to use to make the coding regions of transcripts

TO DO

### UTRs and their introns

* `--left5 x --right3 y` specifies left/5' extension of x nucleotides, right/3' or y nucleotides.
* `--removeUTRintrons` default value FALSE, returns a warning if TRUE but no `five_prime_UTR_intron` or `three_prime_UTR_intron` features in gff
* `--left5 x --right3 y` --removeUTRintrons TRUE` fixed-length features only after removing UTR introns
* `--useUTRs` defaults to FALSE
* `--useUTRs TRUE` looks for `five_prime_UTR` and `three_prime_UTR` features in gff to use to make transcript extremities. Should give error and stop if *no* `five_prime_UTR` or `three_prime_UTR` features available. Should give output saying how many CDS/Parent features have `five_prime_UTR` and `three_prime_UTR` features.
* `--useUTRs TRUE --removeUTRintrons FALSE` combination should give some kind of warning
* Either `--useUTRs TRUE` or `--left5 x --right3 y` should be specified. Return error if neither specified or if both specified.
 

# Examples still needed

* fixed-length extensions but still removing nearby UTR introns. We could adapt YBL72ish.
* ensembl format gff
* gff with 3'UTR introns
* examples with multiple ORFs on a transcript, drosophila/human/bacterial?
